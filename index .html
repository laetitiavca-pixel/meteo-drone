<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>üå¶Ô∏è M√©t√©o Drone ‚Äî Vent, Rafales, Radar & Pr√©visions 48h</title>

  <!-- Open Graph (Discord/Twitter) -->
  <meta property="og:title" content="üå¶Ô∏è M√©t√©o Drone ‚Äî Carte des vents & radar pluie en direct"/>
  <meta property="og:description" content="Vent, rafales, radar pluie et pr√©visions 48h. Estimations de vitesse du vent jusqu'√† 500 m d'altitude (profil 1/7)."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://TON-DOMAINE.vercel.app/"/>
  <meta property="og:image" content="https://TON-DOMAINE.vercel.app/og.png"/>
  <meta property="og:image:width" content="1200"/>
  <meta property="og:image:height" content="630"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="theme-color" content="#3A9BDC"/>

  <style>
    :root {
      --bg:#0b1220;
      --panel:#121a33;
      --accent:#18a0fb;
      --text:#eef3ff;
      --muted:#8aa0c7;
      --ok:#2ecc71;
      --warn:#f1c40f;
    }
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; background:linear-gradient(180deg,#0b1220,#0e1430 40%,#0b1220); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .wrap { max-width:1200px; margin:24px auto; padding:0 16px; }
    .header { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .logo { width:36px; height:36px; border-radius:12px; background:linear-gradient(135deg,#3aa8ff,#1d6fff); display:grid; place-items:center; box-shadow:0 6px 18px rgba(24,160,251,.4);}
    .tabs { display:flex; gap:8px; margin:12px 0 18px; flex-wrap:wrap; }
    .tab { padding:10px 14px; border-radius:12px; background:rgba(255,255,255,.06); cursor:pointer; user-select:none; }
    .tab.active { background:var(--accent); color:#02142b; font-weight:700; }
    .grid { display:grid; grid-template-columns: 2fr 1fr; gap:16px; }
    iframe { width:100%; height:540px; border:0; border-radius:16px; box-shadow:0 12px 26px rgba(0,0,0,.3); }
    .card { background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:16px; backdrop-filter: blur(4px); }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:8px 0; }
    .pill { padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.08); color:var(--muted); font-size:12px; }
    .table { width:100%; border-collapse: collapse; margin-top:6px; font-size:14px; }
    .table th, .table td { padding:8px 10px; text-align:right; border-bottom:1px dashed rgba(255,255,255,.08);}
    .table th:first-child, .table td:first-child { text-align:left; }
    .note { color:var(--muted); font-size:12px; margin-top:8px; }
    .footer { text-align:center; color:var(--muted); font-size:12px; margin:14px 0; }
    .btn { background:var(--accent); color:#02142b; border:0; padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer; }
    .small { font-size:12px; color:var(--muted);}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">üõ∞Ô∏è</div>
      <div>
        <div style="font-weight:800;">M√©t√©o Drone</div>
        <div class="small">Vents, rafales, radar pluie & pr√©visions 48h ‚Äî centr√© sur votre position.</div>
      </div>
      <div style="flex:1"></div>
      <button id="locBtn" class="btn">üìç Utiliser ma position</button>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="wind">üí® Carte des vents</div>
      <div class="tab" data-tab="radar">üåßÔ∏è Radar pluie</div>
    </div>

    <div class="grid">
      <div>
        <div id="panel-wind">
          <iframe id="windFrame" title="Carte des vents (Windy)" allow="fullscreen"
            src="https://embed.windy.com/embed2.html?lat=48.85&lon=2.35&detailLat=48.85&detailLon=2.35&zoom=6&level=surface&overlay=wind&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=true&metricWind=kmh&metricTemp=%C2%B0C&radarRange=-1">
          </iframe>
        </div>
        <div id="panel-radar" style="display:none;">
          <iframe id="radarFrame" title="Radar pluie (Windy)" allow="fullscreen"
            src="https://embed.windy.com/embed2.html?lat=48.85&lon=2.35&detailLat=48.85&detailLon=2.35&zoom=6&level=surface&overlay=radar&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=true&metricWind=kmh&metricTemp=%C2%B0C&radarRange=-1">
          </iframe>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div style="font-weight:700;">Point m√©t√©o</div>
            <div class="small" id="point">Paris (48.85, 2.35)</div>
          </div>
          <div class="pill" id="updated">‚Äî</div>
        </div>

        <div class="row">
          <div class="pill">Temp√©rature : <b id="temp">‚Äî</b> ¬∞C</div>
          <div class="pill">Vent 10 m : <b id="v10">‚Äî</b> km/h</div>
          <div class="pill">Rafales : <b id="gust">‚Äî</b> km/h</div>
        </div>

        <table class="table" id="altTable">
          <thead>
            <tr>
              <th>Altitude</th>
              <th>Vitesse (km/h)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="note">
          Vitesse du vent estim√©e aux altitudes sup√©rieures via profil √©olien <b>1/7</b> : v(z) = v‚ÇÅ‚ÇÄ √ó (z/10)^0.14.
          Ces valeurs donnent un ordre de grandeur utile √† l‚Äôorientation des vols, mais peuvent diff√©rer des mod√®les.
        </div>

        <div style="margin-top:12px; font-weight:700;">Pr√©visions 48h</div>
        <div id="forecast" class="small">Chargement‚Ä¶</div>
      </div>
    </div>

    <div class="footer">
      Donn√©es m√©t√©o : Open‚ÄëMeteo ‚Ä¢ Cartes : Windy (ECMWF). ‚Äî Ce site n‚Äôest pas destin√© √† un usage a√©ronautique officiel.
    </div>
  </div>

  <script>
    // Tabs
    document.querySelectorAll('.tab').forEach(t => {
      t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        const tab = t.dataset.tab;
        document.getElementById('panel-wind').style.display = tab==='wind'?'block':'none';
        document.getElementById('panel-radar').style.display = tab==='radar'?'block':'none';
      });
    });

    // Geolocation
    const locBtn = document.getElementById('locBtn');
    locBtn.addEventListener('click', () => {
      if (!navigator.geolocation) return alert("G√©olocalisation non support√©e.");
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = +pos.coords.latitude.toFixed(3);
        const lon = +pos.coords.longitude.toFixed(3);
        setLocation(lat, lon, true);
      }, () => alert("Impossible de r√©cup√©rer la position."));
    });

    function setLocation(lat, lon, updateFrames) {
      document.getElementById('point').textContent = `(${lat}, ${lon})`;
      if (updateFrames) {
        const base = "https://embed.windy.com/embed2.html";
        const wf = document.getElementById('windFrame');
        const rf = document.getElementById('radarFrame');
        const common = `lat=${lat}&lon=${lon}&detailLat=${lat}&detailLon=${lon}&zoom=7&level=surface&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=true&metricWind=kmh&metricTemp=%C2%B0C&radarRange=-1`;
        wf.src = `${base}?${common}&overlay=wind`;
        rf.src = `${base}?${common}&overlay=radar`;
      }
      fetchMeteo(lat, lon);
    }

    // Meteo data (Open-Meteo)
    async function fetchMeteo(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,wind_speed_10m,wind_gusts_10m&forecast_days=2&timezone=auto`;
      const res = await fetch(url);
      const data = await res.json();
      const nowIndex = 0;
      const T = data.hourly.temperature_2m[nowIndex];
      const V10 = data.hourly.wind_speed_10m[nowIndex];
      const G10 = data.hourly.wind_gusts_10m[nowIndex];
      document.getElementById('temp').textContent = Math.round(T);
      document.getElementById('v10').textContent = Math.round(V10);
      document.getElementById('gust').textContent = Math.round(G10);
      document.getElementById('updated').textContent = new Date(data.hourly.time[nowIndex]).toLocaleString();

      const alts = [10,30,60,120,200,300,400,500];
      const tbody = document.querySelector('#altTable tbody');
      tbody.innerHTML = "";
      alts.forEach(z => {
        const v = V10 * Math.pow(z/10, 0.14);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${z} m</td><td><b>${Math.round(v)}</b></td>`;
        tbody.appendChild(tr);
      });

      // 48h forecast every 6h
      const times = data.hourly.time;
      let html = "";
      for (let i=0; i<Math.min(times.length, 48); i+=6) {
        const dt = new Date(times[i]);
        const t = data.hourly.temperature_2m[i];
        const v = data.hourly.wind_speed_10m[i];
        const g = data.hourly.wind_gusts_10m[i];
        html += `<div class='row'><div class='pill'>${dt.toLocaleString()}</div><div class='pill'>T: <b>${Math.round(t)}¬∞C</b></div><div class='pill'>V10: <b>${Math.round(v)} km/h</b></div><div class='pill'>Raf: <b>${Math.round(g)} km/h</b></div></div>`;
      }
      document.getElementById('forecast').innerHTML = html;
    }

    // init Paris
    setLocation(48.85, 2.35, false);
  </script>
</body>
</html>
