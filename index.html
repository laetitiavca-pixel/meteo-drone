<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>üå¶Ô∏è M√©t√©o Drone ‚Äî Vent, Rafales, Radar & Pr√©visions 48h</title>

 <!-- Open Graph pour Discord et r√©seaux sociaux -->
<meta property="og:title" content="üå§Ô∏è M√©t√©o Drone ‚Äî Vent & Radar Live">
<meta property="og:description" content="Carte m√©t√©o interactive : vents, rafales, radar pluie et pr√©visions 48h. Donn√©es adapt√©es aux vols de drones.">
<meta property="og:image" content="https://raw.githubusercontent.com/laetitiavca-pixel/meteo-drone/main/og.png">
<meta property="og:type" content="website">
<meta property="og:url" content="https://meteo-drone.vercel.app/">
<meta name="twitter:card" content="summary_large_image">


  <style>
    :root{
      --bg:#0b1220; --panel:#121a33; --accent:#18a0fb;
      --text:#eef3ff; --muted:#8aa0c7;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b1220,#0e1430 40%,#0b1220);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#3aa8ff,#1d6fff);display:grid;place-items:center;box-shadow:0 6px 18px rgba(24,160,251,.4)}
    .small{font-size:12px;color:var(--muted)}
    .btn{background:var(--accent);color:#02142b;border:0;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
    .tabs{display:flex;gap:8px;margin:12px 0 8px;flex-wrap:wrap}
    .tab{padding:10px 14px;border-radius:12px;background:rgba(255,255,255,.06);cursor:pointer;user-select:none}
    .tab.active{background:var(--accent);color:#02142b;font-weight:700}
    .subtabs{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0 12px}
    .pill.small{padding:6px 10px;border-radius:999px;border:0;background:rgba(255,255,255,.08);color:#cfe2ff;font-size:12px;cursor:pointer}
    .pill.small.active{background:#18a0fb;color:#02142b;font-weight:700}
    #mapWrap{width:100%}
    #mapFrame{width:100%;height:50vh;border:0;border-radius:16px;box-shadow:0 12px 26px rgba(0,0,0,.3)}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px;margin-top:12px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;backdrop-filter: blur(4px)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:8px 0}
    .pill{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.08);color:var(--muted);font-size:12px}
    .table{width:100%;border-collapse:collapse;margin-top:6px;font-size:14px}
    .table th,.table td{padding:8px 10px;text-align:right;border-bottom:1px dashed rgba(255,255,255,.08)}
    .table th:first-child,.table td:first-child{text-align:left}
    .footer{text-align:center;color:var(--muted);font-size:12px;margin:14px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">üõ∞Ô∏è</div>
      <div>
        <div style="font-weight:800;">M√©t√©o Drone</div>
        <div class="small">Vents, rafales, pression & radar pluie ‚Äî pr√©visions 48h ‚Äî centr√© sur votre position.</div>
      </div>
      <div style="flex:1"></div>
      <button id="locBtn" class="btn">üìç Utiliser ma position</button>
    </div>

    <!-- Onglets principaux -->
    <div class="tabs">
      <div class="tab active" data-tab="wind">üí® Carte des vents</div>
      <div class="tab" data-tab="radar">üåßÔ∏è Radar pluie</div>
      <div class="tab" data-tab="pressure">üå™Ô∏è Pression</div>
    </div>

    <!-- Mini-onglets (couches rapides) -->
    <div class="subtabs">
      <button class="pill small active" data-overlay="wind">Vent</button>
      <button class="pill small" data-overlay="gust">Rafales</button>
      <button class="pill small" data-overlay="temp">Temp√©rature</button>
      <button class="pill small" data-overlay="clouds">Nuages</button>
      <button class="pill small" data-overlay="rainAccu">Pluie 24h</button>
    </div>

    <!-- Carte Windy (pleine largeur, 50% hauteur) -->
    <div id="mapWrap">
      <iframe id="mapFrame" title="Carte Windy"
        src="https://embed.windy.com/embed2.html?lat=48.85&lon=2.35&detailLat=48.85&detailLon=2.35&zoom=7&level=surface&overlay=wind&menu=&message=true&marker=&calendar=&pressure=&type=map&location=coordinates&detail=true&metricWind=kmh&metricTemp=%C2%B0C&radarRange=-1"
        allow="fullscreen"></iframe>
    </div>

    <!-- Trafic a√©rien (affich√© seulement quand 'Radar' est actif) -->
    <div id="traffic" class="card" style="display:none; margin-top:12px;">
      <div style="font-weight:700;margin-bottom:8px;">‚úàÔ∏è Trafic a√©rien en direct</div>
      <iframe id="adsbFrame" title="ADS-B Exchange"
        src="https://globe.adsbexchange.com/?lat=48.85&lon=2.35&zoom=7&hideSidebar&hideButtons"
        style="width:100%; height:400px; border:0; border-radius:12px;"></iframe>
      <div class="small" style="margin-top:6px">Source : ADS-B Exchange (int√©gration autoris√©e). Sur mobile, cela peut consommer plus de batterie.</div>
    </div>

    <div class="grid">
      <!-- Colonne gauche : Pr√©visions -->
      <div class="card">
        <div style="font-weight:700;">Pr√©visions 48h (toutes les 6h)</div>
        <div id="forecast" class="small" style="margin-top:8px;">Chargement‚Ä¶</div>
      </div>

      <!-- Colonne droite : Panneau m√©t√©o -->
      <div class="card">
        <div class="row" style="justify-content:space-between;">
          <div>
            <div style="font-weight:700;">Point m√©t√©o</div>
            <div class="small" id="point">Paris (48.85, 2.35)</div>
          </div>
          <div class="pill" id="updated">‚Äî</div>
        </div>

        <div class="row">
          <div class="pill">Temp√©rature : <b id="temp">‚Äî</b> ¬∞C</div>
          <div class="pill">Vent 10 m : <b id="v10">‚Äî</b> km/h</div>
          <div class="pill">Rafales : <b id="gust">‚Äî</b> km/h</div>
        </div>

        <table class="table" id="altTable">
          <thead>
            <tr><th>Altitude</th><th>Vitesse (km/h)</th><th>Direction</th></tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="small" style="margin-top:8px;">
          Vitesse aux altitudes sup√©rieures estim√©e via profil √©olien <b>1/7</b> : v(z) = v‚ÇÅ‚ÇÄ √ó (z/10)^0.14.
          Ordre de grandeur utile, peut diff√©rer des mod√®les.
        </div>
      </div>
    </div>

    <div class="footer">
      Donn√©es m√©t√©o : Open-Meteo ‚Ä¢ Cartes : Windy (ECMWF). ‚Ä¢ Trafic : ADS-B Exchange.
    </div>
  </div>

  <script>
    const mapFrame = document.getElementById('mapFrame');
    const trafficBox = document.getElementById('traffic');
    const adsb = document.getElementById('adsbFrame');

    // --- Onglets principaux ---
    document.querySelectorAll('.tab').forEach(t => {
      t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        t.classList.add('active');

        const overlay = t.dataset.tab === 'wind' ? 'wind'
                      : t.dataset.tab === 'radar' ? 'radar'
                      : 'pressure';
        // sync mini-onglets visuellement
        document.querySelectorAll('.subtabs .pill.small').forEach(p => p.classList.remove('active'));
        const match = document.querySelector(`.subtabs .pill.small[data-overlay="${overlay}"]`);
        if (match) match.classList.add('active');

        setOverlay(overlay);
      });
    });

    // --- Mini-onglets (pills) ---
    document.querySelectorAll('.subtabs .pill.small').forEach(p => {
      p.addEventListener('click', () => {
        document.querySelectorAll('.subtabs .pill.small').forEach(x => x.classList.remove('active'));
        p.classList.add('active');
        setOverlay(p.dataset.overlay); // wind/gust/temp/clouds/rainAccu...
      });
    });

    function setOverlay(overlay){
      const url = new URL(mapFrame.src);
      url.searchParams.set('overlay', overlay);
      mapFrame.src = url.toString();
      // Trafic visible seulement avec 'radar'
      if (trafficBox) trafficBox.style.display = (overlay === 'radar') ? 'block' : 'none';
    }

    // --- G√©olocalisation ---
    document.getElementById('locBtn').addEventListener('click', () => {
      if (!navigator.geolocation) return alert("G√©olocalisation non support√©e.");
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = +pos.coords.latitude.toFixed(3);
        const lon = +pos.coords.longitude.toFixed(3);
        setLocation(lat, lon);
      }, () => alert("Impossible de r√©cup√©rer la position."));
    });

    function updateEmbedsLatLon(lat, lon){
      // Windy
      const windy = new URL(mapFrame.src);
      windy.searchParams.set('lat', lat);
      windy.searchParams.set('lon', lon);
      windy.searchParams.set('detailLat', lat);
      windy.searchParams.set('detailLon', lon);
      mapFrame.src = windy.toString();
      // ADS-B
      if (adsb){
        const a = new URL(adsb.src);
        a.searchParams.set('lat', lat);
        a.searchParams.set('lon', lon);
        adsb.src = a.toString();
      }
    }

    // --- Donn√©es m√©t√©o Open-Meteo ---
    async function fetchMeteo(lat, lon){
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,wind_speed_10m,wind_gusts_10m,wind_direction_10m&forecast_days=2&timezone=auto`;
      const res = await fetch(url);
      const data = await res.json();
      const times = data.hourly.time;

      // approx "maintenant" = premier pas
      const i = 0;
      const T = data.hourly.temperature_2m[i];
      const V10 = data.hourly.wind_speed_10m[i];
      const G10 = data.hourly.wind_gusts_10m[i];
      const DIR10 = data.hourly.wind_direction_10m[i];

      document.getElementById('temp').textContent = Math.round(T);
      document.getElementById('v10').textContent = Math.round(V10);
      document.getElementById('gust').textContent = Math.round(G10);
      document.getElementById('updated').textContent = new Date(times[i]).toLocaleString();

      // Vitesse par altitude (profil 1/7) + direction approx = direction 10 m
      const alts = [10,30,60,120,200,300,400,500];
      const tbody = document.querySelector('#altTable tbody');
      tbody.innerHTML = "";
      alts.forEach(z => {
        const v = V10 * Math.pow(z/10, 0.14);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${z} m</td><td><b>${Math.round(v)}</b></td><td>${degToCardinal(DIR10)} (${Math.round(DIR10)}¬∞)</td>`;
        tbody.appendChild(tr);
      });

      // Pr√©visions 48h toutes les 6h
      let html = "";
      for (let k=0; k<Math.min(times.length, 48); k+=6){
        const dt = new Date(times[k]);
        const t  = data.hourly.temperature_2m[k];
        const v  = data.hourly.wind_speed_10m[k];
        const g  = data.hourly.wind_gusts_10m[k];
        html += `<div class='row'><div class='pill'>${dt.toLocaleString()}</div><div class='pill'>T: <b>${Math.round(t)}¬∞C</b></div><div class='pill'>V10: <b>${Math.round(v)} km/h</b></div><div class='pill'>Raf: <b>${Math.round(g)} km/h</b></div></div>`;
      }
      document.getElementById('forecast').innerHTML = html;
    }

    function degToCardinal(d){
      const dirs = ['N','NE','E','SE','S','SW','W','NW'];
      return dirs[Math.round(d/45) % 8];
    }

    function setLocation(lat, lon){
      document.getElementById('point').textContent = `(${lat}, ${lon})`;
      updateEmbedsLatLon(lat, lon);
      fetchMeteo(lat, lon);
    }

    // Init Paris
    setOverlay('wind');
    setLocation(48.85, 2.35);
  </script>
</body>
</html>


<!-- redeploy -->
